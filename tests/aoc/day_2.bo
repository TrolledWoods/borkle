library "base.bo";
import "day2_input.bo";

#entry fn() -> u64 {
    let parse = INPUT;

    let depth = 0 : i64;
    let pos = 0 : i64;
    let aim = 0 : i64;

    take_whitespace(&parse);
    while not(empty(&parse)) {
        let command = take_word(&parse);
        take_whitespace(&parse);
        let number = take_u64(&parse);
        take_whitespace(&parse);

        if cmp_strings(command, "forward") {
            pos = pos + (cast number : i64);
            depth = depth + aim * (cast number : i64);
        } else if cmp_strings(command, "down") {
            aim = aim + (cast number : i64);
        } else if cmp_strings(command, "up") {
            aim = aim - (cast number : i64);
        } else {
            print("Invalid command ");
            print(command);
            print("!\n");
        };
    };

    print("Depth is ");
    assert(depth >= 0);
    print_u64(cast depth);
    print(", position is ");
    print_u64(cast pos);
    print(", product is ");
    print_u64(cast (depth * pos));
    print("\n");

    #0
};
